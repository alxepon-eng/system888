<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cute EduSubmit System</title>
    
    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/lucide-react@latest"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #fce7f3;
        }
        .neo-brutalism {
            border: 2px solid black;
            box-shadow: 4px 4px 0px 0px rgba(0,0,0,1);
        }
        .neo-brutalism-sm {
            border: 2px solid black;
            box-shadow: 2px 2px 0px 0px rgba(0,0,0,1);
        }
        .neo-brutalism:active {
            box-shadow: 0px 0px 0px 0px rgba(0,0,0,1);
            transform: translate(4px, 4px);
        }
        .animate-fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #fff0f5; }
        ::-webkit-scrollbar-thumb { background: #ec4899; border-radius: 4px; }
    </style>
<script type="importmap">
{
  "imports": {
    "react/": "https://esm.sh/react@^19.2.4/",
    "react": "https://esm.sh/react@^19.2.4",
    "vite": "https://esm.sh/vite@^7.3.1",
    "@vitejs/plugin-react": "https://esm.sh/@vitejs/plugin-react@^5.1.2",
    "lucide-react": "https://esm.sh/lucide-react@^0.563.0",
    "react-dom/": "https://esm.sh/react-dom@^19.2.4/"
  }
}
</script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;
        const { 
            GraduationCap, School, LogOut, CheckCircle, XCircle, 
            Plus, Trash2, Link: LinkIcon, Save, Users, FileText,
            Upload, X, FileText: FileIcon, BookOpen, Calendar, 
            Send, ClipboardCheck, Edit, Search, Star, RefreshCw,
            ExternalLink, Download, MessageCircle
        } = LucideReact;

        // --- Constants ---
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyCB4HCiyyBp_6ryT7Iq1Iyr-hDAriiL7WTJ0PQrB5lTThBkn8loo_HG7Yl3LyYRzJ-/exec";
        const SUBJECTS = ["โปรแกรมกราฟิก", "เทคโนโลยีคลาวด์", "การเขียนโปรแกรมเว็บ", "ระบบฐานข้อมูล", "เครือข่ายคอมพิวเตอร์เบื้องต้น"];
        const TEACHER_PASSWORD = "555";
        
        const MOCK_STUDENTS = {
            "6920010001": { name: "นายกิตติพงศ์ ใจมั่น", group: "ปวช. 1/1" },
            "6920010002": { name: "นางสาวชลธิชา รักดี", group: "ปวช. 1/1" },
            "6920010011": { name: "นายธีรภัทร อ่อนหวาน", group: "ปวช. 1/2" },
            "68319100016": { name: "นางสาวกัญลักษณ์ เพ็ชรสุทธิ์", group: "ปวส. 2/1" },
            "67319100024": { name: "นางสาวสุวดี รุ่งเรืองอักษร", group: "ปวส. 2/2" },
            "67319100043": { name: "นายอานนท์ ช่างเรือ", group: "ปวส. 2/3" }
            // ... (ข้อมูลนักเรียนอื่นๆ สามารถเพิ่มได้ที่นี่)
        };

        // --- UI Components ---
        const Button = ({ children, variant = 'primary', isLoading, className = '', ...props }) => {
            const baseStyle = "px-6 py-2 rounded-xl font-bold transition-all transform neo-brutalism flex items-center justify-center gap-2";
            const variants = {
                primary: "bg-pink-500 text-white hover:bg-pink-600",
                secondary: "bg-white text-black hover:bg-gray-100",
                danger: "bg-red-500 text-white hover:bg-red-600",
            };
            return (
                <button className={`${baseStyle} ${variants[variant]} ${isLoading ? 'opacity-70 cursor-not-allowed' : ''} ${className}`} disabled={isLoading || props.disabled} {...props}>
                    {isLoading && <div className="animate-spin h-5 w-5 border-2 border-white border-t-transparent rounded-full"></div>}
                    {children}
                </button>
            );
        };

        const Input = ({ label, error, className = '', ...props }) => (
            <div className="flex flex-col gap-1 w-full">
                {label && <label className="text-gray-800 font-bold ml-1">{label}</label>}
                <input className={`w-full px-4 py-2 rounded-xl border-2 border-black focus:outline-none focus:ring-2 focus:ring-pink-300 neo-brutalism-sm ${className}`} {...props} />
                {error && <span className="text-red-500 text-sm ml-1">{error}</span>}
            </div>
        );

        const Select = ({ label, options, placeholder, disablePlaceholder = true, className = '', ...props }) => (
            <div className="flex flex-col gap-1 w-full">
                {label && <label className="text-gray-800 font-bold ml-1">{label}</label>}
                <select className={`w-full px-4 py-2 rounded-xl border-2 border-black focus:outline-none focus:ring-2 focus:ring-pink-300 neo-brutalism-sm bg-white ${className}`} {...props}>
                    <option value="" disabled={disablePlaceholder}>{placeholder || "-- กรุณาเลือก --"}</option>
                    {options.map((opt) => (<option key={opt.value} value={opt.value}>{opt.label}</option>))}
                </select>
            </div>
        );

        // --- Services ---
        const apiService = {
            async submit(data) {
                const response = await fetch(`${GOOGLE_SCRIPT_URL}?t=${Date.now()}`, {
                    method: 'POST',
                    mode: 'no-cors', // สคริปต์ Google มักต้องใช้ no-cors ในบางกรณี หรือ handle cors ที่ฝั่ง Apps Script
                    headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                    body: JSON.stringify({ ...data, action: 'SUBMIT' }),
                });
                return { status: 'success', message: 'ส่งข้อมูลเรียบร้อยแล้ว (กำลังรอการประมวลผลจาก Google Sheets)' };
            },
            async getSubmissions() {
                try {
                    const response = await fetch(`${GOOGLE_SCRIPT_URL}?action=GET_SUBMISSIONS&t=${Date.now()}`);
                    const result = await response.json();
                    return result.data || [];
                } catch (e) { return []; }
            }
        };

        // --- Main App Logic ---
        const App = () => {
            const [role, setRole] = useState('GUEST');
            const [isLoading, setIsLoading] = useState(false);
            const [status, setStatus] = useState({ type: 'idle', message: '' });

            const handleSubmission = async (data) => {
                setIsLoading(true);
                try {
                    const res = await apiService.submit(data);
                    setStatus({ type: 'success', message: res.message });
                } catch (e) {
                    setStatus({ type: 'error', message: 'เกิดข้อผิดพลาดในการส่ง' });
                } finally {
                    setIsLoading(false);
                }
            };

            if (status.type !== 'idle') {
                return (
                    <div className="min-h-screen flex items-center justify-center p-4">
                        <div className="bg-white p-8 rounded-2xl neo-brutalism max-w-sm w-full text-center">
                            {status.type === 'success' ? <CheckCircle size={80} className="text-green-500 mx-auto mb-4" /> : <XCircle size={80} className="text-red-500 mx-auto mb-4" />}
                            <h2 className="text-2xl font-bold mb-2">{status.type === 'success' ? 'สำเร็จ!' : 'ผิดพลาด'}</h2>
                            <p className="text-gray-600 mb-6">{status.message}</p>
                            <Button onClick={() => setStatus({type:'idle', message:''})} className="w-full">ตกลง</Button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen pb-10">
                    <header className="bg-white border-b-4 border-black p-4 mb-8 sticky top-0 z-10 shadow-md">
                        <div className="max-w-3xl mx-auto flex items-center justify-between">
                            <div className="flex items-center gap-3">
                                <div className="w-10 h-10 bg-pink-500 rounded-lg border-2 border-black flex items-center justify-center shadow-[2px_2px_0px_0px_rgba(0,0,0,1)]">
                                    <span className="text-white font-bold text-xl">Edu</span>
                                </div>
                                <h1 className="text-lg md:text-xl font-bold text-gray-800 leading-tight">ระบบส่งข้อมูลงาน</h1>
                            </div>
                            {role !== 'GUEST' && <button onClick={() => setRole('GUEST')} className="p-2 bg-red-50 text-red-500 rounded-full border-2 border-black"><LogOut size={20}/></button>}
                        </div>
                    </header>

                    <main className="max-w-3xl mx-auto px-4">
                        {role === 'GUEST' && <LoginView onLogin={setRole} />}
                        {role === 'STUDENT' && <StudentView onSubmit={handleSubmission} isLoading={isLoading} />}
                        {role === 'TEACHER' && <TeacherView onSubmit={handleSubmission} isLoading={isLoading} />}
                    </main>

                    {isLoading && (
                        <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center backdrop-blur-sm">
                            <div className="bg-white p-6 rounded-2xl neo-brutalism flex flex-col items-center">
                                <div className="w-12 h-12 border-4 border-pink-200 border-t-pink-500 rounded-full animate-spin mb-4"></div>
                                <p className="font-bold">กำลังประมวลผล...</p>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const LoginView = ({ onLogin }) => {
            const [tab, setTab] = useState('student');
            const [pass, setPass] = useState('');
            return (
                <div className="max-w-md mx-auto space-y-6">
                    <div className="flex neo-brutalism rounded-xl overflow-hidden bg-white">
                        <button onClick={() => setTab('student')} className={`flex-1 py-3 font-bold ${tab === 'student' ? 'bg-pink-500 text-white' : ''}`}>นักเรียน</button>
                        <button onClick={() => setTab('teacher')} className={`flex-1 py-3 font-bold ${tab === 'teacher' ? 'bg-purple-600 text-white' : ''}`}>อาจารย์</button>
                    </div>
                    <div className="bg-white p-8 rounded-xl neo-brutalism">
                        {tab === 'student' ? (
                            <div className="text-center space-y-4">
                                <GraduationCap size={60} className="mx-auto text-pink-500" />
                                <h2 className="text-2xl font-bold">เข้าสู่ระบบส่งงาน</h2>
                                <Button onClick={() => onLogin('STUDENT')} className="w-full">เริ่มใช้งาน</Button>
                            </div>
                        ) : (
                            <div className="space-y-4">
                                <School size={60} className="mx-auto text-purple-600" />
                                <Input type="password" label="รหัสผ่าน" value={pass} onChange={e => setPass(e.target.value)} />
                                <Button onClick={() => pass === TEACHER_PASSWORD ? onLogin('TEACHER') : alert('ผิด')} className="w-full bg-purple-600">เข้าสู่ระบบ</Button>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // --- StudentView & TeacherView Logic (Simplified version of your previous files) ---
        const StudentView = ({ onSubmit, isLoading }) => {
            const [members, setMembers] = useState([]);
            const [subject, setSubject] = useState('');
            const [title, setTitle] = useState('');
            
            const handleSubmit = (e) => {
                e.preventDefault();
                onSubmit({ role: 'STUDENT', subject, members, assignmentTitle: title, timestamp: new Date().toISOString() });
            };

            return (
                <form onSubmit={handleSubmit} className="space-y-6 animate-fade-in">
                    <div className="bg-pink-50 p-4 rounded-xl border-2 border-pink-200 space-y-4">
                        <Select label="วิชา *" options={SUBJECTS.map(s => ({label:s, value:s}))} value={subject} onChange={e => setSubject(e.target.value)} required />
                        <Input label="หัวข้องาน *" value={title} onChange={e => setTitle(e.target.value)} required />
                        <div className="bg-white p-4 rounded-xl border-2 border-black">
                            <label className="font-bold block mb-2">สมาชิก (เพิ่มโดยใช้รหัส)</label>
                            <p className="text-xs text-gray-500 mb-2">ทดสอบด้วยรหัส: 6920010001, 68319100016</p>
                            <Input placeholder="รหัสนักเรียน" onKeyDown={e => {
                                if(e.key === 'Enter' && MOCK_STUDENTS[e.target.value]) {
                                    setMembers([...members, {id: e.target.value, name: MOCK_STUDENTS[e.target.value].name}]);
                                    e.target.value = '';
                                }
                            }} />
                            <div className="mt-4 space-y-2">
                                {members.map((m, i) => (
                                    <div key={i} className="flex justify-between bg-gray-50 p-2 rounded border border-black">
                                        <span>{m.name}</span>
                                        <button type="button" onClick={() => setMembers(members.filter((_, idx) => idx !== i))}><Trash2 size={16} className="text-red-500"/></button>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                    <Button type="submit" isLoading={isLoading} className="w-full">ส่งงาน</Button>
                </form>
            );
        };

        const TeacherView = ({ onSubmit, isLoading }) => {
            const [tab, setTab] = useState('assign');
            return (
                <div className="space-y-6">
                    <div className="flex bg-white rounded-xl p-1 border-2 border-black">
                        <button onClick={() => setTab('assign')} className={`flex-1 py-2 font-bold ${tab === 'assign' ? 'bg-purple-100' : ''}`}>มอบหมายงาน</button>
                        <button onClick={() => setTab('grade')} className={`flex-1 py-2 font-bold ${tab === 'grade' ? 'bg-purple-100' : ''}`}>ตรวจงาน</button>
                    </div>
                    {tab === 'assign' ? (
                        <div className="bg-white p-6 rounded-xl border-2 border-black space-y-4">
                            <Select label="วิชา" options={SUBJECTS.map(s => ({label:s, value:s}))} />
                            <Input label="เรื่อง" />
                            <Input type="date" label="กำหนดส่ง" />
                            <Button className="w-full bg-purple-600">สร้างงาน</Button>
                        </div>
                    ) : <div className="text-center p-10 bg-white rounded-xl border-2 border-black">ระบบดึงข้อมูลจาก Google Sheets อัตโนมัติ</div>}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
